import { VerticalBox , HorizontalBox} from "std-widgets.slint";

export component VerticalVolume inherits Rectangle {
        in property <length> bar-height;
        in property <length> bar-spacing;
        in property <color> bar-color;
        in property <color> inert-bar-color;
        in property <float> value;
        in property <float> ceiling;

        // calculate how many bars are active
        function calculate_active_bars() -> int {
                // Use Math.min to constrain since value could grow beyond ceiling
                Math.min(value / ceiling * calc_max_bars(), calc_max_bars());
        }

        // this needs to be nudged a bit, we're either have a rounding error or
        // are failing to account for something like padding or alignment or something
        // looks like the delta is the height of ~2 bars
        function calc_max_bars() -> int {
                self.height / (self.bar-height + self.bar-spacing) - 2;
        }

        VerticalBox {
                spacing: bar_spacing;
                 // align end so active-bars stack from the bottom-up
                alignment: end;

                // draw inert bars
                for i in (calc_max_bars() - calculate_active_bars()) : Rectangle {
                        background: inert-bar-color;
                        height: bar-height;
                }
                // draw active bars
                for i in calculate_active_bars() : Rectangle {
                        background: bar-color;
                        height: bar-height;
                }
        }
}